# ほうじ茶（Houjicha）ドキュメント

法的推論のための形式言語「ほうじ茶」の公式ドキュメントです。

---

## 1. 概要

### 目的
**法的三段論法を構造化し、AIによる執筆支援を実現する**

- 論証構造を形式言語で記述
- 構造化されたデータを基にAIが提案・補完
- 再利用可能な規範・理由のデータベース構築

### 設計思想

プログラミングにおいてコンパイルエラーが「これじゃ動かない」と教えてくれるように、
ほうじ茶は「この法的推論は構造的に成立しない」と教えてくれます。

- **形式的チェック**（要件の欠落など）→ プログラム（ほうじ茶）の仕事
- **実質的判断**（論理矛盾、事実認定など）→ AI/法律家の仕事

---

## 2. 構文リファレンス

### 記号一覧

| 記号 | 名前 | 用途 | 例 |
|------|------|------|-----|
| `#` | 主張 | 法的結論 | `#窃盗罪^刑法235条` |
| `*` | 要件 | 構成要件 | `*他人の財物` |
| `%` | 規範 | 解釈基準 | `%占有者の意思に反して` |
| `?` | 論点 | 問題提起 | `? 不法領得の意思は必要か` |
| `>>` | 効果 | 法的効果 | `>> 窃盗罪成立` |
| `<=` | あてはめ | 事実への適用 | `<= 甲が持ち去った` |
| `^` | 根拠条文 | 条文参照 | `^刑法235条` |
| `+` | 肯定結論 | 成立する | `+#窃盗罪` |
| `!` | 否定結論 | 成立しない | `!#窃盗罪` |
| `::` | 名前空間 | 論述の区切り | `:: 甲の罪責` |
| `@` | 評価 | 事実への評価付与 | `事実@評価` |
| `;` | 理由 | 論理展開の理由 | `; 判例の立場による` |
| `∵` | 思考過程メモ | 自分用のメモ | `∵ ここは要検討` |
| `~>` | 理由（論点内） | 論点の理由 | `~> 使用窃盗との区別` |
| `=>` | 導出 | 規範の導出 | `=> %規範` |
| `( & \| )` | 複合事実 | 事実の論理結合 | `(A & B)` |
| `//` | コメント | 注釈 | `// コメント` |

### 基本構文

#### 主張（Claim）
```houjicha
#窃盗罪^刑法235条 <= 甲の行為:
    *他人の財物 <= 本件財布はAの所有
    *窃取 <= 持ち去った
    >> 窃盗罪が成立する
```

#### 要件と規範
```houjicha
*窃取: %占有者の意思に反して占有を移転 <= 甲が持ち去った
```

#### 論点
```houjicha
? 不法領得の意思は必要か ~> 使用窃盗との区別 => %不法領得の意思
```

#### 名前空間
```houjicha
:: 甲の罪責
    #窃盗罪^刑法235条 <= 甲の行為

:: 乙の罪責
    #窃盗罪の共同正犯^60条・235条 <= 乙の行為
```

#### 評価（複数@）
```houjicha
*暴行脅迫 <= 乙がナイフを突きつけた@凶器使用@計画的@深夜
```

#### 理由と思考過程メモ
```houjicha
*他人の財物 <= 本件財布
    ; 財産犯の基本的構成要件である（論理展開の理由）
    ∵ ここは争いないので簡潔に（自分用メモ）
```

### 法学概念との対応

```
法源（条文・法令等）
    ↓ 文言を分解
法的要件
    ↓ 不確定性がある場合
解釈（規範）
    ↓
事実 + 法的評価（あてはめ）
    ↓ 全要件を満たす場合
法的効果
```

---

## 3. システムアーキテクチャ

### 現在の構成

```
┌─────────────────────────────────────────────────────┐
│  VS Code Extension                                  │
│  ┌─────────────────────────────────────────────┐   │
│  │  Language Client                             │   │
│  └─────────────────────────────────────────────┘   │
│                         │                           │
│                         ▼                           │
│  ┌─────────────────────────────────────────────┐   │
│  │  LSP Server                                  │   │
│  │  ├── Lexer (トークン化)                      │   │
│  │  ├── Parser (AST構築)                        │   │
│  │  ├── Diagnostics (エラー検出)                │   │
│  │  ├── Completion (補完)                       │   │
│  │  └── Article Database (YAML)                 │   │
│  └─────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### YAMLデータベース

条文ごとに要件・規範・論点を定義：

```yaml
# articles/刑法/235_窃盗.yaml
id: "刑法235条"
name: "窃盗罪"
アノテーション:
  - 範囲: "他人の財物"
    種別: "要件"
    解釈:
      - 規範: "他人が所有する財産的価値のある有体物"
  - 範囲: "窃取"
    種別: "要件"
    解釈:
      - 規範: "占有者の意思に反して占有を移転すること"
```

---

## 4. MCPツール

### 設計思想

ほうじ茶のMCPツールは、プログラミング言語におけるLSP（Language Server Protocol）と同じ役割を果たします。

| プログラミング言語/LSP | ほうじ茶/MCP |
|----------------------|-------------|
| コンパイルエラー | 必須要件の欠落エラー |
| Linter警告 | 論点の検討推奨 |
| 補完候補 | 要件・論点の候補 |
| スニペット展開 | テンプレート展開 |
| シンボル検索 | 条文検索 |

### AIの利用フロー

```
1. AI: 事実を受け取る
2. AI: MCPツールで .houjicha を生成
3. ほうじ茶: エラー返す「必須要件Xが未検討」
4. AI: 修正して再生成
5. ほうじ茶: 警告返す「論点Yの検討を推奨」
6. AI: 必要性を判断してスキップ or 追加
7. ほうじ茶: OK
8. AI: 完成した法的推論を返す
```

---

## 5. VS Code拡張の使い方

### インストール

1. `.vsix`ファイルをダウンロード
2. VS Codeで`Extensions: Install from VSIX...`を実行
3. `.houjicha`または`.hcha`ファイルを開く

### キーバインド

| キー | コマンド |
|------|---------|
| `Ctrl+Space` | 補完候補を表示 |
| `Ctrl+Shift+V` | プレビューを開く |
| `Ctrl+Shift+H` | 記号早見表を表示 |

### 機能

- **シンタックスハイライト**: 記号ごとに色分け
- **補完**: 記号入力時に候補を表示
- **エラー検出**: 構文エラー、欠落要件を警告
- **ホバー情報**: 記号にカーソルを合わせると説明を表示
- **アウトライン**: 論証構造をツリー表示

---

## 6. ファイル構成

```
macha/
├── src/
│   ├── language/
│   │   ├── ast.ts          # AST型定義
│   │   ├── lexer.ts        # トークナイザー
│   │   ├── parser.ts       # パーサー
│   │   └── loader.ts       # YAML ローダー
│   ├── lsp/
│   │   └── server.ts       # LSPサーバー
│   ├── mcp/
│   │   └── server.ts       # MCPサーバー
│   └── vscode-extension/
│       └── extension.ts    # VS Code拡張
├── articles/               # 条文データベース（YAML）
├── examples/               # サンプルファイル
├── docs/                   # ドキュメント
└── package.json
```

---

## 7. 将来構想

### RAGベースアーキテクチャ

- ベクトルDBとの連携
- 概念の正規化（同じ意味は同じベクトルに収束）
- クロスファイル参照

### AI補完

- ゴーストライティング（Tab補完）
- 文脈を考慮した提案
- 規範・理由の自動提案

### 法的権威充足構造

法学では何かを確定させるときに「それが何の権威に支えられているか」を常に考えます。
将来的には、権威レベル（判例・通説・学説等）の管理機能を追加予定。

---

## 8. サンプルコード

```houjicha
// 窃盗罪の検討

#窃盗罪^刑法235条 <= 甲がスーパーで商品を持ち去った行為:
    ∵ まず構成要件を順に検討していく
    *他人の財物: %他人が所有する財産的価値のある有体物 <= 本件商品はスーパー所有
    *窃取: %占有者の意思に反して占有を移転 <= 甲が商品をカバンに入れた
        ∵ いつ占有移転したかは論点になりうるが、カバン挿入時で問題ないだろう
    *不法領得の意思: %権利者排除意思と利用処分意思 <= 甲は自己の物とする意思あり
    %故意 <= 認識認容あり
    >> 甲に窃盗罪が成立する
```

---

## 技術スタック

- **言語**: TypeScript
- **LSP**: vscode-languageserver / vscode-languageclient
- **MCP**: @modelcontextprotocol/sdk
- **パッケージング**: vsce
- **YAML**: js-yaml
