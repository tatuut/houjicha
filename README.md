# ほうじ茶（Houjicha）

```
        ＿＿＿
      ／ほうじ＼
     |  ◕ ◕  |    「法的三段論法を、もっと楽しく！」
      ＼  ▽  ／
        ￣￣￣
```

---

## このプロジェクトについて

### Matchaとの出会い

ほうじ茶は、[**Matcha**](https://www.elecode.jp/matcha) という素晴らしいプロジェクトに触発されて生まれました。

Matchaは「法律答案をコードする」ための専門言語です。法的推論を形式的に記述し、構造化された方法で表現できるツール——そのアイデアに強く惹かれました。

法律の答案を書くとき、私たちは常に同じ構造を繰り返します。
「規範を定立して、事実をあてはめて、結論を出す」——法的三段論法です。

でも、この構造は頭の中にあるだけで、明示的に書き出されることはありません。
だから、要件を一つ飛ばしてしまったり、論点の検討を忘れてしまったり。
答案を書き終わってから「あ、これ書き忘れた」と気づくことも。

プログラミングでコンパイラが「この変数は未定義です」と教えてくれるように、
「この要件はまだ検討されていません」と教えてくれる仕組みがあったら？

それがMatchaの目指すところでした。

### なぜ分岐したのか

Matchaは非常に面白いプロジェクトでしたが、OSSではありませんでした。
「こんな機能があったら便利だな」と思っても、参加する方法がなかったのです。

そして私には、もう一つの目的がありました。

**人間が使うことを主軸としない使い方——AIによる法的起案を加速させたい。**

AIによる法律業務の品質を最低限担保するためには、リンターエラー機能がどうしても必要でした。
AIが法的推論を生成したとき、「この要件が欠落しています」「この論点の検討を推奨します」と
フィードバックを返せる仕組み。それがなければ、AIの出力は構造的な品質チェックを受けられません。

そのために必要なのが **MCP（Model Context Protocol）** への対応です。

### LSPとゴーストライターの時代

CursorやGitHub Copilotの登場以降、AIを使った開発の形は大きく変わりました。

**ゴーストライター** ——AIが先読みして自動で補完候補を提案し、人間がTabで承認する。
この共同作業への移行が加速しています。

その際に必要なのは **LSP（Language Server Protocol）** です。
構文を自動解析し、エディタと連携する仕組み。VS CodeやCursorと統合できる基盤。

これがあれば、あとは自動補完用のLLMを作り、ほうじ茶のデータで学習することで、
より実務家の思考過程や処理過程を補完するエコシステムが構築できます。

だから、**MCP対応**と**LSP実装**を主眼に据えて、このプロジェクトを始めました。

### 名前の由来

元々のインスピレーション元が「Matcha」という名前だったので、
同じ日本茶つながりで「ほうじ茶（Houjicha）」と名付けました。

なんとなくほうじ茶は廉価で下町感があります。
麦茶でもよかったのですが、なんとなく麦茶はあまり法律っぽくないので……

マスコットは「**ほうじ茶さん**」。一緒に法的三段論法を学んでいきましょう！

### 参加してください！

このプロジェクトはOSSです。

- 「こんな機能がほしい」
- 「この構文はこうした方がいい」
- 「条文データベースを充実させたい」

やりたいことがある人、ぜひ参加してください！

Claude Opus 4.5が一発でLSPを作れるようになった時代、こういうプロジェクトも現実的になりました。

---

## 設計思想

### 学習コストは低く、汎用性は高く

ほうじ茶を設計するうえで重視したのは、**学習コストを極力低く、汎用性を極力高く**ということです。

Matchaの構文は便利なところが多かったので極力これをベースにしつつ、VS Codeで使いやすいように調整しました。自動補完や`Ctrl+Space`でのヒントが使いやすくなるように。だから記号早見表は`Ctrl+Shift+H`でいつでも見られるようにしています。

### データの蓄積と再利用

AIは組み込んでいないので、条文データを`articles/`に登録する必要があります。

ある程度安定した論点はここにノート代わりに書くと、次回も使えるようになります。AIがここに登録するMCPツールもあるので、自動で蓄積されていくとベストです。

それより細かい「考えたこと」や「次も使いたいこと」は、まさに`.houjicha`ファイルに`as`や定数定義で書くことで再利用できる仕組みです。

### 形式と内容の峻別

ほうじ茶は**一切法的な判断をしません**。

あくまで入力補助が主眼で、それができれば内容の賢さは他の言語やリンターと同じようにAIや人間がすべきだと考えています。

**ほうじ茶がやること**:
- 入力補助（補完、テンプレート展開）
- エラー検出（バリデーション）
- データ提供（条文DB、要件・論点の候補）

**ほうじ茶がやらないこと**:
- 契約書の解析（AIシステムの仕事）
- 法令適合性の判断（AIシステムの仕事）
- 事実認定（法律家の仕事）

プログラミングにおいてコンパイルエラーが「これじゃ動かない」と教えてくれるように、
ほうじ茶は「この法的推論は構造的に成立しない」と教えてくれます。
でも、「この推論は正しい」とは言いません。それは人間やAIの仕事です。

---

## 将来やりたいこと

### ゴーストライティング（Tab補完）

```
%不法領得の意思 <= |
                   │
                   ▼
    ┌─────────────────────────────────┐
    │ 👻 甲は財布を自己の物として     │  ← AIゴースト提案
    │    利用処分する意思を有していた │
    └─────────────────────────────────┘
                   │
                   │ Tab
                   ▼
%不法領得の意思 <= 甲は財布を自己の物として利用処分する意思を有していた
```

AIが先読みして補完候補を提案し、人間がTabで承認する。
この共同作業を実現するために、LSPを実装しています。

### 法的権威充足構造

法学では何かを確定させるときに「それが何の権威に支えられているか」を常に考えます。
権威は固定的な階層ではなく、**通用力**（みんながこれを基準にしている度合い）によって動的に決まります。

```
【第1層：最高規範】
└── 憲法、条約

【第2層：法的拘束力あり（通用力が確立）】
├── 法律（国会制定法）
├── 政令・省令・条例（委任に基づく）
├── 最高裁判例（裁判所は逆らえない）
├── 通説（通用力が確立したもの）
└── 行政解釈（行政相手の訴訟では拘束力あり）

【第3層以下：通用力によって可変】
├── 高裁判例
├── 地裁判例
├── 有力説
├── 学説
└── etc.
```

この構造の詳細な実装は将来のAIエコシステム設計で検討します。
通用力は事案ごとに調整が必要で、思考ルールとしてAIに伝える方が適切だと考えています。

### RAGベースアーキテクチャ

**「実体はベクトル、関係だけ保持」**

```
┌─────────────────────────────────────────────────────────┐
│  RAG空間（ベクトルDB）                                   │
│                                                         │
│    ● vec_001「不法領得の意思」                           │
│    ● vec_002「権利者排除意思」                           │
│    ● vec_003「甲が財布を持ち去った」                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
                    │
                    │ ベクトルID参照
                    ▼
┌─────────────────────────────────────────────────────────┐
│  構文ファイル（関係性グラフ）                             │
│                                                         │
│    # 窃盗罪                                              │
│      └─[要件]─→「窃取」                                  │
│            └─[規範]─→ % vec_005                         │
│                  └─[あてはめ]─→ vec_003                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**メリット**:
1. **概念の正規化**: 同じ意味は同じベクトルに収束
2. **検索効率**: テキスト全文ではなくベクトル類似度で検索
3. **クロスファイル**: 別ファイルの関連箇所が自動で見つかる
4. **AI連携**: ベクトル空間はLLMと相性が良い

---

## 使い方

### インストール

1. `.vsix`ファイルをダウンロード
2. VS Codeで`Extensions: Install from VSIX...`を実行
3. `.houjicha`または`.hcha`ファイルを開く

### キーバインド

| キー | コマンド |
|------|---------|
| `Ctrl+Space` | 補完候補を表示 |
| `Ctrl+Shift+V` | プレビューを開く |
| `Ctrl+Shift+H` | 記号早見表を表示 |

構文や記号の詳細は`Ctrl+Shift+H`の記号早見表で確認できます。

### サンプルファイルで体験！

まずはサンプルファイルを開いて、実際に手を動かしてみてください：

- [demo-try-commands.houjicha](./examples/demo-try-commands.houjicha) - **まずはこれ！** 補完機能を試せるファイル

完成例も参考にどうぞ：

- [demo-complete.houjicha](./examples/demo-complete.houjicha) - 窃盗罪の完全な論証例
- [demo-civil.houjicha](./examples/demo-civil.houjicha) - 民法（虚偽表示）の例

---

## ロードマップ

### Phase 1: 基盤強化 ✅ 完了
- [x] 基本構文のパーサー
- [x] LSPサーバー
- [x] VS Code拡張
- [x] YAMLデータベース
- [x] 行内複合構文
- [x] 規範ネスト
- [x] 思考過程メモ（`∵`）

### Phase 2: 補完システム 🚧 進行中
- [ ] db-search モード
- [ ] candidate-cycle モード
- [ ] InlineCompletionProvider

### Phase 3: AI連携
- [ ] ai-generate モード
- [ ] Tab補完でゴースト受け入れ
- [ ] 文脈を考慮した提案

### Phase 4: RAGアーキテクチャ
- [ ] ベクトル化パイプライン
- [ ] 関係性グラフの保存形式設計
- [ ] クロスファイル参照
- [ ] 概念の自動提案

---

## クレジット

このプロジェクトは [Matcha](https://www.elecode.jp/matcha) のアイデアに触発されて生まれました。
法律答案をコードするという素晴らしい発想に感謝します。

---

> 「ほうじ茶さんと一緒に、法的三段論法をもっと楽しく！」
>
> `.houjicha` または `.hcha` ファイルで書けるよ！
> それじゃあ、よい法的三段論法ライフを！
